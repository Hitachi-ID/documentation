9.Log into the Unix server with adminis tr ativ e  privileges, and extract the files from the idmunix archive. 9.
For example for Debian 9.x, at a terminal prompt enter the following commands:
cd /tmp 
tar -zxvf idmunix-debian-9.x64.tar.gz
Locate the following files:
hid-common_12.0.1_amd64.deb 
hid-idapi_12.0.1_amd64.deb 
hid-mobproxy_12.0.1_amd64.deb
10. With adminis tr ativ e  privileges, extract the files from the deb archive. 10.
For example, at a terminal prompt enter the following commands for Debian 9.x:
cd /tmp 
sudo dpkg -i hid-common_12.0.1_amd64.deb 
sudo dpkg -i hid-idapi_12.0.1_amd64.deb 
sudo dpkg -i hid-mobproxy_12.0.1_amd64.deb
Install the mobile proxy server using the setup-mobproxy script
The Mobile Proxy Service may be installed using the setup-mobproxy.sh  ins t allation  script.
The dependencies for the httpd  or apache2 web server will be checked and any additional  required
modules will be aut omatic ally  installed.
setup-mobproxy.sh
Usage: 
setup-mobproxy.sh proxy-url (syntax: scheme://host[:port]/company/
instance)
The authkey  parameter may be optionally  passed in to specify the authentic ation  key. This is used for
the value for Proxy server authentic ation  key in the Mobile Worker Service c on figur ation.  If a value is not
specified  then it will be auto-generated by the install script.
The loglevel  parameter may be optionally  passed in to specify the log level for the mobile proxy log
messages on the Linux server. If this is not specified  then the default is to set it to warning . These are
the available log levels:
▪error▪
▪warning▪
▪info▪
▪debug▪
The proxy URL that is passed in is what is specified  for the value for Proxy server URL in the Mobile
Worker Service c on figur ation.  The host and port are for the mobile proxy server. The default port is 443 if
it is omitted.Example ins t allation  command for setup-mobproxy.sh: 
authkey="authkeyvalue" loglevel=debug ./setup-mobproxy.sh https://
mobile.bravurasecurity.com/hid/pm
Install the Mobile Proxy Service using setup-mobproxy.sh :
1.Log into the Unix server with adminis tr ativ e  privileges. At a terminal prompt enter the following 1.
commands to locate the ins t allation  script and view the help usage:
cd /usr/local/psunix/mobproxy 
sudo ./setup-mobproxy.sh
2.Run the ins t allation  script. For example: 2.
authkey="authkeyvalue" loglevel=debug ./setup-mobproxy.sh https://
mobile.bravurasecurity.com/hid/pm
When installing with an http s  address and for SSL, the ins t allation  script will prompt you for an SSL/TLS
certific a t e  and the private key, or if you wish to allow for the script to generate a self-signed
certific a t e.
The certific a t e  file must contain the site certific a t e,  intermediate certific a t es  and the root certific a t e.
The separated intermediate certific a t es  need to be combined into the certific a t e  file, or manually add
the SSL Certific a t eChainFile  c on fig  line into the Apache c on fig  file. Once the site is up and running, an
online SSL certific a t e  checker can be used to verify the site SSL certific ation.
Wait a few minutes for the script to c ontinue  and complete the ins t allation.
3.The ins t allation  will prompt you to apply the settings  for the Mobile Worker Service in Bravura 3.
Security Fabric  . The ins t allation  will provide the c on figur ation  details. Use the primary Bravura
Security Fabric  server's WebUI to:
a. Con figur e  the Mobile Worker Service a.
To c on figur e  the Mobile Worker Service:
If you need the c onfiguration  details after  the initial  ins t allation  you can can run setup-
mobproxy.sh  on the Bravura One mobile proxy server.
1.Log in to Bravura Security Fabric  as a superuser. 1.
2.Click Manage the system > Maintenance > Services . 2.
3.Select Bravura Security (mobworker) Mobile Worker Service . 3.
4. Con figur e  the Proxy server authentic ation  key to be the same as the authentic ation  encr yption 4.
key that is c on figur ed  on the Bravura One mobile proxy  server.
5. Con figur e  the Proxy server  URL for the URL of the Bravura One mobile proxy  server. For 5.
example:
https://mobproxy.bravurasecurity.com/your_company/<instance>/
Ensure that the instance name as set for the URL in Proxy server URL  is the same as the
instance name as c on figur ed  for the Bravura Security Fabric  server.
If a load balancer is being used for the Bravura One mobile proxy  servers, the load balancer URL
must be specified  in Proxy server URL. This is also the public url in which the Bravura One  app willcommunicate with and to locate a Bravura One mobile proxy  server as designated by the load
balancer.
6. Con figur e  the Private proxy server URL  for this instance for the URL of the Bravura One mobile 6.
proxy  server that will be used for the persistent c onnection  for c ommunic ation  with this
instance for when a load balancer environment is c on figur ed  for the proxy servers.
This parameter is not required if a load balanced url has not been c on figur ed  for Proxy server
URL.
In load balanced environments for the Bravura One mobile proxy  servers, this value may be a
single value for a specific  proxy server or it may be set to multiple  Bravura One mobile proxy
servers in a comma-separated list. Setting  it to multiple  proxy servers is to allow for failover for
if a Bravura One mobile proxy  server is taken offline  or is unavailable. The next proxy server as
designated by the load balancer and is in this list will be used for the c onnections  to ensure that
the Bravura One  app may c ontinue  to be used uninterrupted. Each Bravura One mobile proxy
server used as a failover must in the comma-separated list for Private proxy server URL for this
instance .
When the Bravura Security Fabric  server is set up for database r eplic ation,  the value for Private
proxy server URL for this instance  across the instance nodes may also be either set to the same
Bravura One mobile proxy  server or they may each be set for their own proxy server.
In all cases, the instance name as de fined  in each of the urls for the Private proxy server URL for
this instance  must be the same as the instance name as c on figur ed  for the Bravura Security
Fabric  server.
See Con figuring  load balancing for the Bravura One  mobile proxy  (on page 1463) for more
in f ormation  on load balancing the Bravura One mobile proxy  servers.
7. Con figur e  the URL of the local instance for the fully qualified  url of the Bravura Security Fabric 7.
server that the Mobile Worker Service is currently running on. This must be set on each server
when a load balancer environment is c on figur ed  for the Bravura One mobile proxy  servers to
ensure that they are unique on each instance and does not fall back to BASE_IDSYNCH_URL,
which would end up being the same across all replicated nodes. The Bravura Security Fabric
server must also be c on figur ed  for HTTPS for the url for load balanced mobile proxy server
environments.
Set this using the following format: https://<fqdn>/<instance_name>
8. Con figur e  the Push notific ation  server authentic ation  key to be the authentic ation  encr yption 8.
key that is c on figur ed  for the Bravura One mobile proxy  push notific ation  server.
9. Con figur e  the Push notific ation  server URL  for the url of the Bravura One mobile proxy  push 9.
notific ation  server.
Contact support@bravurasecurity.com for assistance with the c onfiguration  and access of the
Bravura One mobile proxy push notific ation  server and for the Push notific ation  server
authentic ation  key and Push notific ation  server URL for your environment.
10. If the Bravura Security Fabric  server uses a self-signed certific a t e  for HTTPS encr yption,  check 10.
the checkbox for Ignore all server certific a t e  warnings .11. If the Bravura Security Fabric  server is c on figur ed  separately to use a corporate proxy server, 11.
such as for Windows updates for example, then set HTTP proxy to use for outgoing c onnections
(address:port)  to the corporate proxy server. For this c on figur ation,  the Bravura One mobile
proxy  server will need to be added to a bypass list. For example, using winhttp , this may be
c on figur ed  with the following command:
netsh winhttp set proxy proxy-server="http://
corporateproxy.bravurasecurity.com:80" bypass-list="https://
mobproxy.bravurasecurity.com"
12. Con figur e  the rest of the parameters as needed. The defaults values may also be used. 12.
The Mobile Worker Service timeout  should be a smaller value than the minimum value of the
timeout  setting  for Mobile Proxy Service and any proxy time,  or fire wall  timeout  in between the
Mobile Worker Service and Mobile Proxy Service.
If Aut omatic ally  determine proxy server timeout  is checked, the Mobile Worker Service will
aut omatic ally  decrease the given setting  to an appropriate one if the c ommunic ation  is broken
unexpectedly.
13. Click Update to update the settings. 13.
See Mobile Worker Service  (on page 2858) for help c on figuring  the Mobile Worker Service
(mobworker ).
b.Enable the Mobile Worker Serviceb.
After  you have c on figur ed  the Mobile Worker Service, you must enable and start the service. On
the Service in f ormation  page:
1.Click Enable the service . 1.
2.Click Start the service . 2.
c.Return to the prompt for the ins t allation  script c.
To use the primary Bravura Security Fabric server's WebUi, bypass the load balancer to connect
directly to the primary node's URL, or RDP to the primary applic ation  node and use the WebUI via
localhost. Check the page footer to ensure the WebUI is rendered from the primary applic ation
node.
After  running the ins t allation  script, the command output indicates the values that will be used by
the ins t allation  script for the scheme, mobile proxy server name, company and instance name,
proxy server authentic ation  key, and log level. Some of these values will also be used for the
rewrite rule in the apache c on figur ation  for what will be used to communicate with the Mobile
Worker Service service.
Log messages will be shown on the command output indic ating  c onnection  in f ormation  to the
Mobile Worker Service and Bravura Security Fabric  server.
A rollback script is also generated to remove the mobile proxy c on figur ation  added by the
ins t allation  script and undo the changes in case you need to redo the ins t allation  or c on figur ation
settings.Once it is complete, the script will indicate that the mobile proxy service has been installed
successfully.
Notes
▪The mobproxy-<company>-<instance>.conf  c on figur ation  file for the mobile proxy is added ▪
to /etc/httpd/conf.d  on CentOS or /etc/apache2/sites-enabled  on Debian.
This file also contains the rewrite rule for what is used for c on figur ation  parameters used by the
Mobile Worker Service.
Optional:  Adjust the maximum time  diff er ence  between the proxy and instance servers in seconds by
c on figuring  the MAX_TIME_DIFF CGI environment variable. The default is 3600 seconds.
RewriteRule ^/<company>/<instance>/(. ⋆)$ /cgi-bin/logid-<instance>-
<company> [L,PT,E=MAX_TIME_DIF:<new_value_sec>,...]
The following is a CentOS example for the mobproxy-<company>-<instance>.conf c on figur ation  file
added by setup-mobproxy.sh:
<VirtualHost <:443> 
  ServerName <servername.example.com> 
  Timeout 600 
  ScriptAlias "/cgi-bin/" "/var/www/cgi-bin/" 
  # Enable FollowSymLinks 
  <Directory "/var/www/cgi-bin/"> 
    AllowOverride None 
    Options FollowSymLinks 
    Require all granted 
  </Directory> 
  #LogLevel dumpio:trace8 cgi:trace8 
  CustomLog "/var/log/httpd/mobproxy-<instance>-<company>-
access_log" combined 
  ErrorLog "/var/log/httpd/mobproxy-<instance>-<company>-error_log" 
  RewriteEngine On 
  SSLEngine on 
  SSLCertificateFile /etc/httpd/ssl/certs/<servername.example.com>/
selfsigned-<servername.example.com>.pem 
  SSLCertificateKeyFile /etc/httpd/ssl/private/
<servername.example.com>/selfsigned-<servername.example.com>.key 
  RewriteRule ^/<company>/<instance>/(. ⋆)$ /cgi-bin/logid-
<instance>-<company> [L,PT,E=BYPASSAUTH:.+\\.(woff|woff2|htm|html|
jpg|gif|png|js|css)$,E=DEBUGDUMPENVS:0,E=HTTP_AUTHORIZATION:%
{HTTP:Authorization},E=HTTP_MOBPROXY_KEY:<proxyauthenticationkey>] 
</VirtualHost>The following is a Debian example for the mobproxy-<company>-<instance>.conf
c on figur ation  file added by setup-mobproxy.sh :
<VirtualHost ⋆:443> 
  ServerName <servername.example.com> 
  Timeout 600 
  ScriptAlias "/cgi-bin/" "/usr/lib/cgi-bin/" 
  # Enable FollowSymLinks 
  <Directory "/usr/lib/cgi-bin/"> 
    AllowOverride None 
    Options FollowSymLinks 
    Require all granted 
  </Directory> 
  #LogLevel dumpio:trace8 cgi:trace8 
  CustomLog "/var/log/apache2/mobproxy-<instance>-<company>-
access.log" combined 
  ErrorLog "/var/log/apache2/mobproxy-<instance>-<company>-
error.log" 
  RewriteEngine On 
  SSLEngine on 
  SSLCertificateFile /etc/apache2/ssl/certs/<servername.example.com>/
selfsigned-<servername.example.com>.pem 
  SSLCertificateKeyFile /etc/apache2/ssl/private/
<servername.example.com>/selfsigned-<servername.example.com>.key 
  RewriteRule ^/<company>/<instance>/(. ⋆)$ /cgi-bin/logid-
<instance>-<company> [L,PT,E=BYPASSAUTH:.+\\.(woff|woff2|htm|html|
jpg|gif|png|js|css)$,E=DEBUGDUMPENVS:0,E=HTTP_AUTHORIZATION:%
{HTTP:Authorization},E=HTTP_MOBPROXY_KEY:<proxyauthenticationkey>] 
</VirtualHost>
In the mobproxy-<company>-<instance>.conf c on figur ation  file:
▪<company> is your company name.▪
▪<instance> is the Bravura Security Fabric  instance name. ▪
▪ <pr o xy authentic ationk e y>  is the same shared key that the Mobile Worker Service on the Bravura ▪
Security Fabric  instance is c on figur ed  to use.
▪If you installed for http s  and SSL and chose a self-signed certific a t e  during ins t allation,  obtain the ▪
necessary SSL/TLS certific a t e  for the mobile proxy server and add them into the mobproxy-
<company>-<instance>.conf  c on figur ation  file.
▪Syslog c on figur ation  is also added to the /etc/rsyslog.d/mobproxy-<instance>- ▪
<company>.conf  c on figur ation  file.
▪Custom log files are also generated: ▪CentOS:
/var/log/httpd/mobproxy-<instance>-<company>-access_log
/var/log/httpd/mobproxy-<instance>-<company>-error_log
/var/log/mobproxy-<instance>-<company>.log
Debian:
/var/log/apache2/mobproxy-<instance>-<company>-access.log
/var/log/apache2/mobproxy-<instance>-<company>-error.log
/var/log/mobproxy-<instance>-<company>.log
Con figur e  SSL
Bravura Security  requires that you c on figur e  the site for HTTPS to secure c ommunic ations  between the
Bravura One mobile proxy  server and Bravura Security Fabric  server. It is suggested that you use a
"Modern" c on figur ation  with HSTS enabled for the SSL c on figur ation,  although to increase device
backwards c ompatibility ,  "Intermediate" c on figur ation  is suggested.
An SSL certific a t e  from a trusted Certific a t e  Authority must be used. A self-signed certific a t e  may not be
used for the Mobile Proxy Service.
Before you begin, ensure the following steps are done:
1.Install the SSL module and OpenSSL by running the following command:1.
sudo yum install mod_ssl openssl
2.Load the SSL module by adding it to the default Apache c on figur ation  file, /etc/httpd/conf.d/ 2.
httpd.conf :
LoadModule ssl_module modules/mod_ssl.so
3. Optional:  add the following to the mobproxy-<company>-<instance>.conf  c on figur ation  file 3.
and modify as necessary:
# intermediate configuration, tweak to your needs
SSLProtocol             all -SSLv2 -SSLv3
SSLCipherSuite
ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-
ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-
AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-
SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-
AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-
RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-
SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-
SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-
SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-
SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-
SHA:AES256-SHA:DES-CBC3-SHA:!DSS SSLHonorCipherOrder     on4.Enforce Apache to run the c on figur ed  HTTPS/SSL section  by doing the following in /etc/httpd/ 4.
conf/httpd.conf :
▪Comment out Listen 80  and add Listen 443 . ▪
5.Restart Apache after  c on figur ation: 5.
service httpd restart
T r oubleshooting  notes
Try the following steps to diagnose and recover from faults that may occur on a Bravura One mobile
proxy  server:
1.Test that the c on figur ation  syntax of the Apache server is correct: 1.
sudo apachectl -t
2.Restart the server so that you can read the Apache start-up message. If you get an error, you can then2.
do an online search to help you find more details and solutions.
To restart the server, at a terminal prompt enter the following command:
sudo apachectl restart
3.Check the value for the timeout  entry in the mobproxy-<company>-<instance>.conf c on figur ation  file. 3.
Timeout 600
This value must be set higher than the value c on figur ed  for the timeout  setting  for the Mobile Worker
Service on the Bravura Security Fabric  server.
In most cases the defaults are sufficien t.  The timeout  values may however need to be adjusted.
4.Check that the proxy authentic ation  key matches what is specified  on the Mobile Worker Service 4.
c on figur ation  page for the instance.
The key is located in the c on figur ed  mobile proxy section  in mobproxy-<company>-
<instance>.conf .
5.To view the log messages from syslog in real time,  run the following from a terminal prompt on the 5.
proxy server:
tail -f /var/log/mobproxy-<instance>-<company>.log
The apache logs may also be checked for any warnings or errors. Run the following to see the last few
log entries from each of the log files:
RHEL/CentOS:
tail -n 20 /var/log/httpd/mobproxy-<instance>-<company>-access_log 
tail -n 20 /var/log/httpd/mobproxy-<instance>-<company>-error_log
Debian:
tail -n 20 /var/log/apache2/mobproxy-<instance>-<company>-access.log 
tail -n 20 /var/log/apache2/mobproxy-<instance>-<company>-error.log
6.Ensure that the system time  of the Bravura One mobile proxy  server has been synchronized with the 6.
system time  of the Bravura Security Fabric  server.7.If the SELinux module is enabled on RHEL/CentOS, the module may block mobproxy from being7.
accessed by other web servers. A c on figur ed  SELinux policy file may need to be obtained, or
alt ernativ ely ,  SELinux may need to be disabled for httpd.
To check the SELinux status, run the following:
sudo getenforce
There is a known linking issue when using CentOS 6.8 x84-64. Certain OpenSSL .so files may not be
linked properly. Use strace on mobproxy.linux-glibc and ln to link any missing files appropriately. This
issue may be present if the following error message is observed in the logs "Unable to find MTCSPI
provider shared library [mtcspi-*]. Please make sure it’s in your PATH".
Migr ating  mobile device r egis tr ations
The migratedata.exe  Bravura Security  Data Migr ation  Utility  may be used during a migr ation  to
export and import the mobile device r egis tr ation  data for users so that they are not required to re-
register their devices on the Bravura Security Fabric  server that the data will be imported into.
When migr ating  the mobile device r egis tr ations  and the instance name has changed for Bravura Security
Fabric  and/or the company name has changed for the Bravura One mobile proxy  server Apache
c on figur ation,  the Proxy server URL  address for the Mobile Worker Service may remain the same,
however the rewrite rule in the Apache c on figur ation  on the Bravura One mobile proxy  server will need
to be modified.  This is to ensure that when one or both of these names have changed, that users will not
be required to re-register their mobile devices.
The following will need to be added for the rewrite rule from the previous version in the Apache
c on figur ation:
E=COMPANY:<new-company-name>,E=INSTANCE:<new-instance-name>
A second rewrite rule will need to be added that includes the following:
E=PREVURLPATH:<company>/<instance>/
The two rules are required to ensure that mobile devices that were registered with the previous instance
will still work with the new instance as well as for when new mobile devices are registered using the new
instance.
For example, the rewrite rule from the previous version is removed and replaced with the following two
rewrite rules:
RewriteRule ^/<company>/<instance>/(. ⋆)$ /cgi-bin/mobproxy-new-
version [L,PT,E=COMPANY:<new-company-name>,E=INSTANCE:<new-instance-
name>,E=BYPASSAUTH:.+\\.(woff|woff2|htm|html|jpg|gif|png|js|css)
$,E=DEBUGDUMPENVS:0,E=HTTP_AUTHORIZATION:%
{HTTP:Authorization},E=HTTP_MOBPROXY_KEY:<proxyauthenticationkey>]
RewriteRule ^/<new-company-name>/<new-instance-name>/(. ⋆)$ /cgi-bin/
mobproxy-new-version [L,PT,E=PREVURLPATH:<company>/
<instance>/,E=BYPASSAUTH:.+\\.(woff|woff2|htm|html|jpg|gif|png|js|css)$,E=DEBUGDUMPENVS:0,E=HTTP_AUTHORIZATION:%
{HTTP:Authorization},E=HTTP_MOBPROXY_KEY:<proxyauthenticationkey>]
See Bravura Security Fabric migr ation  documen t ation  for more detailed in f ormation  about migr ations
and the migratedata.exe  Bravura Security  Data Migr ation  Utility .
Customizing mobile proxy log files
Optional:  Customize the log ID in the system logs and redirect logs to a custom log file.
By default the system logs are located at /var/log/messages . The log ID that is noted in the system
logs for the Bravura One mobile proxy  server log messages is by default noted as hitachi-id .
The log messages may be redirected to a custom log file. In this case, log messages generated by the
Bravura One mobile proxy  server will be written  both to the system log file as well as a custom log file.
The log ID that is noted in the log messages may also be customized to a diff er en t  value. This would be
r e flect ed  in the system logs as well as a custom log file, if c on figur ed.
In this example, we will use /usr/local/psunix/mobproxy/logid-mobproxy  as the mobile
proxy binary name and will be r edir ecting  the Bravura One mobile proxy  server log messages
to /var/log/mobproxy.log .
To customize the log ID:
▪Ensure that the mobile proxy binary begins with "logid-".▪
For example if it is named as /usr/local/psunix/mobproxy/mobproxy , then rename it it
to /usr/local/psunix/mobproxy/logid-mobproxy .
▪Ensure that the Apache rewrite rule r e flects  this change for the mobile proxy binary name. ▪
To customize the log file:
▪Locate the syslog c on figur ation  file. By default this is at /etc/rsyslog.conf. ▪
▪Add a line such as the following to the system log c on figur ation  file (note that the program name does ▪
not include " logid- "):
if $programname == 'mobproxy' then /var/log/mobproxy.log
▪Restart the syslog and apache services:▪
CentOS:
service rsyslog restart 
service httpd restart
Debian:
service rsyslog restart 
service apache2 restart
The Bravura One mobile proxy  server logs will now be /var/log/mobproxy.log  in addition  to the
server’s system log file and log entries will contain a log ID of " mobproxy ".